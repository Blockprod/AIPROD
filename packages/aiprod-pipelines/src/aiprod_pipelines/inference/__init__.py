"""
Unified Inference Graph for composable video generation.

Replaces monolithic pipeline classes with a flexible node-based DAG system.
Enables easy composition of inference operations without code duplication.

Core Classes:
  - GraphNode: Abstract base for all nodes
  - GraphContext: Execution context
  - InferenceGraph: DAG executor
  
Concrete Nodes:
  - TextEncodeNode: Text → embeddings
  - DenoiseNode: Iterative denoising
  - UpsampleNode: 2x spatial upsampling
  - DecodeVideoNode: Latents → video
  - AudioEncodeNode: Audio generation
  - CleanupNode: Memory cleanup

Factory:
  - preset(): Factory function for common modes
  - PresetFactory: Class with static preset methods

Example:
    ```python
    from aiprod_pipelines.inference import preset
    
    # Create preset graph
    graph = preset(
        "t2v_two_stages",
        text_encoder=encoder,
        model=model,
        scheduler=scheduler,
        vae_decoder=vae,
        upsampler=upsampler,
        num_inference_steps=30,
    )
    
    # Execute
    result = graph.run(
        prompt="A cat walking through a forest",
        guidance_scale=7.5,
        seed=42,
    )
    ```
"""

from .graph import GraphNode, GraphContext, InferenceGraph
from .nodes import (
    TextEncodeNode,
    DenoiseNode,
    UpsampleNode,
    DecodeVideoNode,
    AudioEncodeNode,
    CleanupNode,
)
from .presets import (
    PresetFactory,
    preset,
    PresetCache,
    preset_cache_config,
    preset_cache_clear,
    preset_cache_size,
    preset_cached_t2v_one_stage,
    preset_cached_t2v_two_stages,
    preset_cached_distilled_fast,
    preset_cached_ic_lora,
    preset_cached_keyframe_interpolation,
    preset_cached_t2v_one_stage_adaptive,
    preset_cached_t2v_two_stages_adaptive,
    preset_cached_distilled_fast_adaptive,
    preset_cached_ic_lora_adaptive,
    preset_cached_keyframe_interpolation_adaptive,
    preset_cached_t2v_one_stage_quantized,
    preset_cached_t2v_two_stages_quantized,
    preset_cached_distilled_fast_quantized,
    preset_cached_ic_lora_quantized,
    preset_cached_keyframe_interpolation_quantized,
)
from .tiling import (
    TilingSizeConfig,
    NoTiling,
    SpatialTiling,
    TemporalTiling,
    HybridTiling,
    AdaptiveTilingEngine,
    auto_select_tiling,
    TileBlendingManager,
    TilingConfigNode,
    TiledDenoiseWrapper,
)
from .kernel_fusion import (
    FusionConfig,
    FusedAttentionLinear,
    FusedConvActivation,
    FusedGroupNormActivation,
    FusedResidualBlock,
    FusionOperationRegistry,
    GPUCapabilities,
    FusionProfile,
    AdaptiveKernelFusionEngine,
    auto_select_kernel_fusions,
    get_gpu_capabilities,
    KernelFusionSelectorNode,
    FusedDenoiseNode,
    KernelFusionProfiler,
)
from .quality_metrics import (
    FVVRMetric,
    FVVRCalculator,
    FVVRTracker,
    compute_fvvr_efficient,
    LPIPSMetric,
    LPIPSNet,
    LPIPSCalculator,
    compute_lpips_batch_efficient,
    MotionMetric,
    OpticalFlowEstimator,
    MotionConsistencyCalculator,
    QualityScore,
    QualityMonitor,
    QualityAggregator,
)
from .prompt_understanding import (
    PromptToken,
    PromptAnalysisResult,
    PromptAnalyzer,
    RelationType,
    SemanticRelationship,
    TokenRole,
    EnhancedToken,
    SemanticTokenizer,
    EntityType,
    Concept,
    ConceptRelationship,
    ConceptExtractor,
    GraphNode as PromptGraphNode,
    GraphEdge,
    SemanticGraph,
)
from .lora_tuning import (
    LoRAInitType,
    LoRATarget,
    LoRACompositionMode,
    LoRAConfig,
    LoRAAdapter,
    LoRAMetrics,
    LoRACheckpoint,
    LoRAStrategy,
    LoRAPrecisionConfig,
    LoRAWeight,
    LoRALinear,
    LoRAConv2d,
    LoRALayerAdapter,
    LoRAComposer,
    LoRAMerger,
    TrainingState,
    LoRATrainer,
    LoRAEvaluator,
    LoRAInference,
    LoRABatchInference,
    LoRAEnsemble,
    LoRAInferenceConfig,
)
from .multimodal_coherence import (
    AudioFeature,
    AudioEvent,
    AudioProcessor,
    AudioAnalysisResult,
    BatchAudioProcessor,
    VideoFeature,
    MotionEvent,
    VideoAnalyzer,
    VideoAnalysisResult,
    BatchVideoAnalyzer,
    CoherenceMetrics,
    CoherenceScorer,
    CoherenceResult,
    SyncAlignment,
    SyncMetrics,
    SyncEngine,
    AdaptiveSyncController,
    CoherenceSnapshot,
    CoherenceMonitor,
    MultimodalCoherenceNode,
    CoherenceReporter,
)
from .multi_tenant_saas import (
    TenantTier,
    TenantStatus,
    TenantQuotas,
    TenantMetadata,
    TenantContext,
    TenantContextManager,
    TenantRegistry,
    TokenType,
    AuthenticationMethod,
    APIKey,
    JWTToken,
    JWTTokenManager,
    SessionManager,
    AuthenticationManager,
    ResourceType,
    Action,
    RoleType,
    Permission,
    Role,
    UserRole,
    RoleBasedAccessControl,
    PermissionChecker,
    UsageEventType,
    UsageEvent,
    UsageMetrics,
    UsageEventLogger,
    MeteringEngine,
    UsageAggregator,
    BillingCycle,
    InvoiceStatus,
    PricingModel,
    SubscriptionPlan,
    LineItem,
    Invoice,
    BillingCalculator,
    BillingPortal,
    RateLimitWindow,
    RateLimitConfig,
    RequestQuota,
    APIRequest,
    APIResponse,
    RateLimiter,
    RequestValidator,
    APIGateway,
    GatewayMetrics,
    JobStatus,
    JobPriority,
    BatchJob,
    JobResult,
    JobProgressTracker,
    JobScheduler,
    JobManagementPortal,
    FeatureFlagType,
    RolloutStatus,
    FeatureFlag,
    TenantConfig,
    FeatureFlagManager,
    ConfigurationManager,
    HealthStatus,
    MetricSnapshot,
    TenantMetrics,
    MetricsCollector,
    AnomalyDetector,
    AnalyticsCollector,
    HealthMonitor,
)
# Phase 4: Tensor Parallelism
from .tensor_parallelism import (
    ShardingStrategy,
    DataLayout,
    ShardingConfig,
    DeviceMesh,
    TensorShardingPlanner,
    DataParallelPlanner,
    TensorParallelPlanner,
    PipelineParallelPlanner,
    HybridParallelPlanner,
    ShardingPlanner,
    ShardingMetrics,
    CollectiveOp,
    ReduceOp,
    CommunicationBackend,
    CommunicationConfig,
    CommunicationMetrics,
    CollectiveOperation,
    AllReduceOperation,
    AllGatherOperation,
    BroadcastOperation,
    ReduceScatterOperation,
    CommunicationManager,
    OverlappedCommunication,
    DistributedBackend,
    DistributedConfig,
    GPUMemoryConfig,
    CPUAffinity,
    DistributedEnvironment,
    DistributedInitializer,
    ProcessGroupManager,
    DistributedTrainingState,
    DistributedStateManager,
    CheckpointFormat,
    CheckpointMetadata,
    OptimizationState,
    CheckpointManager,
    IncrementalCheckpointing,
    ZeroCheckpointing,
    CheckpointRecoveryStrategy,
    LoadBalancingStrategy,
    DeviceWorkload,
    LoadMetrics,
    LoadBalancer,
    AdaptiveLoadBalancer,
    LoadBalancingConfig,
    GradientAccumulationMode,
    GradientAccumulationConfig,
    GradientBuffer,
    GradientAccumulator,
    DistributedGradientSync,
    GradientCheckpointing,
    GradientCompressionConfig,
    GradientCompression,
    ShardingDimension,
    ShardedTensorSpec,
    ModelShardingStrategy,
    ModelSharder,
    ActivationCheckpointing,
    LayerWisePartitioning,
    SequenceParallelConfig,
    SequenceParallelism,
)
# Phase 4: Distributed LoRA
from .distributed_lora import (
    LoRARank,
    LoRATarget,
    LoRAInitialization,
    DistributedLoRAConfig,
    UserLoRAPreset,
    LoRAModelMetadata,
    DatasetConfig,
    DistributedLoRAConfigManager,
    FederatedAggregationMethod,
    DifferentialPrivacyLevel,
    ClientUpdate,
    ServerState,
    FederatedAggregator,
    DifferentialPrivacyEngine,
    FederatedTrainer,
    FederatedTrainingConfig,
    MergeStrategy,
    AdapterWeight,
    CompositionPlan,
    LoRAMergeEngine,
    ModelInheritance,
    AdapterComposer,
    ModelStatus,
    AccessLevel,
    ModelVersion,
    LoRARegistry,
    ModelDiscovery,
    RegistryConfig,
    UserModelTier,
    UserModelQuota,
    UserModel,
    UserModelManager,
    ModelDeduplication,
    TenantModelManager,
    TrainingMode,
    TrainingMetrics,
    TrainingState,
    DistributedLoRATrainer,
    FederatedLoRATrainer,
    LoRAInferenceOptimizer,
    LoRATrainingConfig,
)

__all__ = [
    # Core
    "GraphNode",
    "GraphContext",
    "InferenceGraph",
    # Nodes
    "TextEncodeNode",
    "DenoiseNode",
    "UpsampleNode",
    "DecodeVideoNode",
    "AudioEncodeNode",
    "CleanupNode",
    # Factory
    "PresetFactory",
    "preset",
    # Cache
    "PresetCache",
    "preset_cache_config",
    "preset_cache_clear",
    "preset_cache_size",
    # Cached presets
    "preset_cached_t2v_one_stage",
    "preset_cached_t2v_two_stages",
    "preset_cached_distilled_fast",
    "preset_cached_ic_lora",
    "preset_cached_keyframe_interpolation",
    "preset_cached_t2v_one_stage_adaptive",
    "preset_cached_t2v_two_stages_adaptive",
    "preset_cached_distilled_fast_adaptive",
    "preset_cached_ic_lora_adaptive",
    "preset_cached_keyframe_interpolation_adaptive",
    "preset_cached_t2v_one_stage_quantized",
    "preset_cached_t2v_two_stages_quantized",
    "preset_cached_distilled_fast_quantized",
    "preset_cached_ic_lora_quantized",
    "preset_cached_keyframe_interpolation_quantized",
    # Tiling
    "TilingSizeConfig",
    "NoTiling",
    "SpatialTiling",
    "TemporalTiling",
    "HybridTiling",
    "AdaptiveTilingEngine",
    "auto_select_tiling",
    "TileBlendingManager",
    "TilingConfigNode",
    "TiledDenoiseWrapper",
    # Kernel Fusion
    "FusionConfig",
    "FusedAttentionLinear",
    "FusedConvActivation",
    "FusedGroupNormActivation",
    "FusedResidualBlock",
    "FusionOperationRegistry",
    "GPUCapabilities",
    "FusionProfile",
    "AdaptiveKernelFusionEngine",
    "auto_select_kernel_fusions",
    "get_gpu_capabilities",
    "KernelFusionSelectorNode",
    "FusedDenoiseNode",
    "KernelFusionProfiler",
    # Quality Metrics
    "FVVRMetric",
    "FVVRCalculator",
    "FVVRTracker",
    "compute_fvvr_efficient",
    "LPIPSMetric",
    "LPIPSNet",
    "LPIPSCalculator",
    "compute_lpips_batch_efficient",
    "MotionMetric",
    "OpticalFlowEstimator",
    "MotionConsistencyCalculator",
    "QualityScore",
    "QualityMonitor",
    "QualityAggregator",
    # Prompt Understanding
    "PromptToken",
    "PromptAnalysisResult",
    "PromptAnalyzer",
    "RelationType",
    "SemanticRelationship",
    "TokenRole",
    "EnhancedToken",
    "SemanticTokenizer",
    "EntityType",
    "Concept",
    "ConceptRelationship",
    "ConceptExtractor",
    "PromptGraphNode",
    "GraphEdge",
    "SemanticGraph",
    # LoRA Fine-tuning
    "LoRAInitType",
    "LoRATarget",
    "LoRACompositionMode",
    "LoRAConfig",
    "LoRAAdapter",
    "LoRAMetrics",
    "LoRACheckpoint",
    "LoRAStrategy",
    "LoRAPrecisionConfig",
    "LoRAWeight",
    "LoRALinear",
    "LoRAConv2d",
    "LoRALayerAdapter",
    "LoRAComposer",
    "LoRAMerger",
    "TrainingState",
    "LoRATrainer",
    "LoRAEvaluator",
    "LoRAInference",
    "LoRABatchInference",
    "LoRAEnsemble",
    "LoRAInferenceConfig",
    # Multimodal Coherence
    "AudioFeature",
    "AudioEvent",
    "AudioProcessor",
    "AudioAnalysisResult",
    "BatchAudioProcessor",
    "VideoFeature",
    "MotionEvent",
    "VideoAnalyzer",
    "VideoAnalysisResult",
    "BatchVideoAnalyzer",
    "CoherenceMetrics",
    "CoherenceScorer",
    "CoherenceResult",
    "SyncAlignment",
    "SyncMetrics",
    "SyncEngine",
    "AdaptiveSyncController",
    "CoherenceSnapshot",
    "CoherenceMonitor",
    "MultimodalCoherenceNode",
    "CoherenceReporter",
    # Multi-Tenant SaaS
    "TenantTier",
    "TenantStatus",
    "TenantQuotas",
    "TenantMetadata",
    "TenantContext",
    "TenantContextManager",
    "TenantRegistry",
    "TokenType",
    "AuthenticationMethod",
    "APIKey",
    "JWTToken",
    "JWTTokenManager",
    "SessionManager",
    "AuthenticationManager",
    "ResourceType",
    "Action",
    "RoleType",
    "Permission",
    "Role",
    "UserRole",
    "RoleBasedAccessControl",
    "PermissionChecker",
    "UsageEventType",
    "UsageEvent",
    "UsageMetrics",
    "UsageEventLogger",
    "MeteringEngine",
    "UsageAggregator",
    "BillingCycle",
    "InvoiceStatus",
    "PricingModel",
    "SubscriptionPlan",
    "LineItem",
    "Invoice",
    "BillingCalculator",
    "BillingPortal",
    "RateLimitWindow",
    "RateLimitConfig",
    "RequestQuota",
    "APIRequest",
    "APIResponse",
    "RateLimiter",
    "RequestValidator",
    "APIGateway",
    "GatewayMetrics",
    "JobStatus",
    "JobPriority",
    "BatchJob",
    "JobResult",
    "JobProgressTracker",
    "JobScheduler",
    "JobManagementPortal",
    "FeatureFlagType",
    "RolloutStatus",
    "FeatureFlag",
    "TenantConfig",
    "FeatureFlagManager",
    "ConfigurationManager",
    "HealthStatus",
    "MetricSnapshot",
    "TenantMetrics",
    "MetricsCollector",
    "AnomalyDetector",
    "AnalyticsCollector",
    "HealthMonitor",
    # Tensor Parallelism (71 exports)
    "ShardingStrategy",
    "DataLayout",
    "ShardingConfig",
    "DeviceMesh",
    "TensorShardingPlanner",
    "DataParallelPlanner",
    "TensorParallelPlanner",
    "PipelineParallelPlanner",
    "HybridParallelPlanner",
    "ShardingPlanner",
    "ShardingMetrics",
    "CollectiveOp",
    "ReduceOp",
    "CommunicationBackend",
    "CommunicationConfig",
    "CommunicationMetrics",
    "CollectiveOperation",
    "AllReduceOperation",
    "AllGatherOperation",
    "BroadcastOperation",
    "ReduceScatterOperation",
    "CommunicationManager",
    "OverlappedCommunication",
    "DistributedBackend",
    "DistributedConfig",
    "GPUMemoryConfig",
    "CPUAffinity",
    "DistributedEnvironment",
    "DistributedInitializer",
    "ProcessGroupManager",
    "DistributedTrainingState",
    "DistributedStateManager",
    "CheckpointFormat",
    "CheckpointMetadata",
    "OptimizationState",
    "CheckpointManager",
    "IncrementalCheckpointing",
    "ZeroCheckpointing",
    "CheckpointRecoveryStrategy",
    "LoadBalancingStrategy",
    "DeviceWorkload",
    "LoadMetrics",
    "LoadBalancer",
    "AdaptiveLoadBalancer",
    "LoadBalancingConfig",
    "GradientAccumulationMode",
    "GradientAccumulationConfig",
    "GradientBuffer",
    "GradientAccumulator",
    "DistributedGradientSync",
    "GradientCheckpointing",
    "GradientCompressionConfig",
    "GradientCompression",
    "ShardingDimension",
    "ShardedTensorSpec",
    "ModelShardingStrategy",
    "ModelSharder",
    "ActivationCheckpointing",
    "LayerWisePartitioning",
    "SequenceParallelConfig",
    "SequenceParallelism",
    # Distributed LoRA (41 exports)
    "LoRARank",
    "LoRATarget",
    "LoRAInitialization",
    "DistributedLoRAConfig",
    "UserLoRAPreset",
    "LoRAModelMetadata",
    "DatasetConfig",
    "DistributedLoRAConfigManager",
    "FederatedAggregationMethod",
    "DifferentialPrivacyLevel",
    "ClientUpdate",
    "ServerState",
    "FederatedAggregator",
    "DifferentialPrivacyEngine",
    "FederatedTrainer",
    "FederatedTrainingConfig",
    "MergeStrategy",
    "AdapterWeight",
    "CompositionPlan",
    "LoRAMergeEngine",
    "ModelInheritance",
    "AdapterComposer",
    "ModelStatus",
    "AccessLevel",
    "ModelVersion",
    "LoRARegistry",
    "ModelDiscovery",
    "RegistryConfig",
    "UserModelTier",
    "UserModelQuota",
    "UserModel",
    "UserModelManager",
    "ModelDeduplication",
    "TenantModelManager",
    "TrainingMode",
    "TrainingMetrics",
    "TrainingState",
    "DistributedLoRATrainer",
    "FederatedLoRATrainer",
    "LoRAInferenceOptimizer",
    "LoRATrainingConfig",
]
