{
  "id": null,
  "uid": null,
  "title": "AIPROD - Monitoring Complet",
  "tags": ["fastapi", "prometheus", "pipeline", "quality", "cost", "backend", "cache", "error"],
  "timezone": "browser",
  "schemaVersion": 37,
  "version": 1,
  "refresh": "10s",
  "panels": [
    { "type": "stat", "title": "Executions du pipeline", "datasource": "Prometheus", "targets": [{ "expr": "sum(pipeline_executions)", "legendFormat": "Executions" }], "gridPos": {"x": 0, "y": 0, "w": 4, "h": 4} },
    { "type": "stat", "title": "Erreurs du pipeline", "datasource": "Prometheus", "targets": [{ "expr": "sum(pipeline_errors)", "legendFormat": "Erreurs" }], "gridPos": {"x": 4, "y": 0, "w": 4, "h": 4} },
    { "type": "stat", "title": "Latence moyenne (ms)", "datasource": "Prometheus", "targets": [{ "expr": "avg(avg_latency_ms)", "legendFormat": "Latence moyenne" }], "gridPos": {"x": 8, "y": 0, "w": 4, "h": 4} },
    { "type": "stat", "title": "Coût moyen ($)", "datasource": "Prometheus", "targets": [{ "expr": "avg(avg_cost)", "legendFormat": "Coût moyen" }], "gridPos": {"x": 0, "y": 4, "w": 4, "h": 4} },
    { "type": "stat", "title": "Score qualité moyen", "datasource": "Prometheus", "targets": [{ "expr": "avg(avg_quality)", "legendFormat": "Qualité moyenne" }], "gridPos": {"x": 4, "y": 4, "w": 4, "h": 4} },
    { "type": "stat", "title": "Jobs créés", "datasource": "Prometheus", "targets": [{ "expr": "sum(jobs_created)", "legendFormat": "Jobs créés" }], "gridPos": {"x": 8, "y": 4, "w": 4, "h": 4} },
    { "type": "stat", "title": "Jobs terminés", "datasource": "Prometheus", "targets": [{ "expr": "sum(jobs_completed)", "legendFormat": "Jobs terminés" }], "gridPos": {"x": 0, "y": 8, "w": 4, "h": 4} },
    { "type": "stat", "title": "Jobs échoués", "datasource": "Prometheus", "targets": [{ "expr": "sum(jobs_failed)", "legendFormat": "Jobs échoués" }], "gridPos": {"x": 4, "y": 8, "w": 4, "h": 4} },
    { "type": "stat", "title": "Cache hits", "datasource": "Prometheus", "targets": [{ "expr": "sum(cache_hits)", "legendFormat": "Hits" }], "gridPos": {"x": 8, "y": 8, "w": 4, "h": 4} },
    { "type": "stat", "title": "Cache misses", "datasource": "Prometheus", "targets": [{ "expr": "sum(cache_misses)", "legendFormat": "Misses" }], "gridPos": {"x": 0, "y": 12, "w": 4, "h": 4} },
    { "type": "stat", "title": "Backend errors", "datasource": "Prometheus", "targets": [{ "expr": "sum(backend_errors)", "legendFormat": "Erreurs backend" }], "gridPos": {"x": 4, "y": 12, "w": 4, "h": 4} },
    { "type": "stat", "title": "Backend fallbacks", "datasource": "Prometheus", "targets": [{ "expr": "sum(backend_fallbacks)", "legendFormat": "Fallbacks" }], "gridPos": {"x": 8, "y": 12, "w": 4, "h": 4} },
    { "type": "stat", "title": "Total Requests (FastAPI)", "datasource": "Prometheus", "targets": [{ "expr": "sum(increase(http_requests_total[1m]))", "legendFormat": "Total" }], "gridPos": {"x": 0, "y": 16, "w": 4, "h": 4} },
    { "type": "stat", "title": "Error Rate (5xx) (FastAPI)", "datasource": "Prometheus", "targets": [{ "expr": "sum(increase(http_requests_total{status=\"500\"}[1m])) / sum(increase(http_requests_total[1m]))", "legendFormat": "5xx Error Rate" }], "gridPos": {"x": 4, "y": 16, "w": 4, "h": 4} },
    { "type": "graph", "title": "Request Duration (avg) (FastAPI)", "datasource": "Prometheus", "targets": [{ "expr": "avg(rate(http_request_duration_seconds_sum[1m])) / avg(rate(http_request_duration_seconds_count[1m]))", "legendFormat": "Avg Duration (s)" }], "gridPos": {"x": 8, "y": 16, "w": 4, "h": 4} },
    { "type": "table", "title": "Requests by Endpoint (FastAPI)", "datasource": "Prometheus", "targets": [{ "expr": "sum by (path) (increase(http_requests_total[1m]))", "legendFormat": "{{path}}" }], "gridPos": {"x": 0, "y": 20, "w": 12, "h": 6} },
    { "type": "stat", "title": "Uptime (seconds) (FastAPI)", "datasource": "Prometheus", "targets": [{ "expr": "time() - process_start_time_seconds{job=\"aiprod-api\"}", "legendFormat": "Uptime" }], "gridPos": {"x": 0, "y": 26, "w": 4, "h": 4} },
    { "type": "stat", "title": "Alertes latence élevée", "datasource": "Prometheus", "targets": [{ "expr": "sum(high_latency)", "legendFormat": "Latence élevée" }], "gridPos": {"x": 4, "y": 26, "w": 4, "h": 4} },
    { "type": "stat", "title": "Alertes coût élevé", "datasource": "Prometheus", "targets": [{ "expr": "sum(high_cost)", "legendFormat": "Coût élevé" }], "gridPos": {"x": 8, "y": 26, "w": 4, "h": 4} },
    { "type": "stat", "title": "Alertes qualité faible", "datasource": "Prometheus", "targets": [{ "expr": "sum(low_quality)", "legendFormat": "Qualité faible" }], "gridPos": {"x": 0, "y": 30, "w": 4, "h": 4} },
    { "type": "stat", "title": "Alertes taux d'erreur élevé", "datasource": "Prometheus", "targets": [{ "expr": "sum(high_error_rate)", "legendFormat": "Taux d'erreur élevé" }], "gridPos": {"x": 4, "y": 30, "w": 4, "h": 4} }
  ]
}
